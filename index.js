var g=Object.defineProperty;var M=(l,e,t)=>e in l?g(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var o=(l,e,t)=>(M(l,typeof e!="symbol"?e+"":e,t),t);import{W as b,S as v,P as L,C as y,V as I,G as E,M as f,A as Y,I as d,B as w,a,b as u,O as C,c as A,D,d as S,T as k,e as z}from"./vendor.js";const H=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}};H();class R{constructor(e=60,t=1.333,n=1,s=1e3){o(this,"aspectRatio");o(this,"fov");o(this,"znear");o(this,"zfar");o(this,"renderer");o(this,"scene");o(this,"camera");o(this,"clock");this.fov=e,this.aspectRatio=t,this.znear=n,this.zfar=s,this.renderer=new b,this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.resize(),window.addEventListener("resize",()=>{this.resize()},!1),window.addEventListener("mousedown",i=>{this.onMouseDown(i)}),window.addEventListener("mouseup",i=>{this.onMouseUp(i)}),window.addEventListener("mousemove",i=>{this.onMouseMove(i)}),window.addEventListener("wheel",i=>{this.onMouseWheel(i)}),window.addEventListener("keydown",i=>{this.onKeyDown(i)}),window.addEventListener("keyup",i=>{this.onKeyUp(i)}),this.scene=new v,this.camera=new L(this.fov,this.aspectRatio,this.znear,this.zfar),this.clock=new y}start(){this.createScene(),this.mainLoop()}mainLoop(){this.update(this.clock.getDelta()),this.renderer.render(this.scene,this.camera),window.requestAnimationFrame(()=>this.mainLoop())}resize(){this.renderer.setSize(window.innerWidth,window.innerHeight);var e=new I;this.renderer.getViewport(e);var t=window.innerWidth/window.innerHeight;this.aspectRatio>t?this.renderer.setViewport(0,(window.innerHeight-window.innerWidth/this.aspectRatio)/2,window.innerWidth,window.innerWidth/this.aspectRatio):this.renderer.setViewport((window.innerWidth-window.innerHeight*this.aspectRatio)/2,0,window.innerHeight*this.aspectRatio,window.innerHeight)}onMouseDown(e){}onMouseUp(e){}onMouseMove(e){}onMouseWheel(e){}onKeyDown(e){}onKeyUp(e){}}class h extends E{constructor(e,t){super();o(this,"name");o(this,"chain");o(this,"boneLength");o(this,"boneId");o(this,"defaultMaterial");o(this,"debugHelper");this.name=e,this.defaultMaterial=new f,this.defaultMaterial.wireframe=!1,this.debugHelper=new Y(.07),this.debugHelper.visible=!1,this.add(this.debugHelper),this.chain=t,this.boneId=-1,this.boneLength=0}createSkeleton(){if(new d.V3,this.name=="root")this.add(new h("upperArm",this.chain));else if(this.name=="upperArm"){this.add(new h("middleArm",this.chain)),this.boneLength=.5;const e=new d.Bone3D(new d.V3(0,.05,0),void 0,new d.V3(0,1,0),this.boneLength);this.chain.addBone(e),this.boneId=this.chain.bones.length-1}else this.name=="middleArm"?(this.add(new h("lowerArm",this.chain)),this.boneLength=.4,this.chain.addConsecutiveBone(new d.V3(0,1,0),this.boneLength),this.boneId=this.chain.bones.length-1):this.name=="lowerArm"?(this.add(new h("endEffector",this.chain)),this.boneLength=.4,this.chain.addConsecutiveBone(new d.V3(0,1,0),this.boneLength),this.boneId=this.chain.bones.length-1):this.name=="endEffector"&&(this.boneLength=.2,this.chain.addConsecutiveBone(new d.V3(0,1,0),this.boneLength),this.boneId=this.chain.bones.length-1);this.children.forEach(e=>{e instanceof h&&e.createSkeleton()})}createMeshes(){if(this.name=="root"){const e=new w(.5,.05,.5),t=new a(e,this.defaultMaterial);t.translateY(.025),this.add(t);const n=new u(.1,16,6,0,Math.PI*2,0,Math.PI/2),s=new a(n,this.defaultMaterial);s.translateY(.05),this.add(s)}if(this.name=="upperArm"){const e=new w(.05,this.boneLength,.05),t=new a(e,this.defaultMaterial);t.translateY(.25),this.add(t);const n=new u(.05),s=new a(n,this.defaultMaterial);s.translateY(.5),this.add(s)}else if(this.name=="middleArm"){this.translateY(.5),this.rotateZ(45*Math.PI/180);const e=new w(.05,this.boneLength,.05),t=new a(e,this.defaultMaterial);t.translateY(.2),this.add(t);const n=new u(.05),s=new a(n,this.defaultMaterial);s.translateY(.4),this.add(s)}else if(this.name=="lowerArm"){this.translateY(.4),this.rotateZ(45*Math.PI/180);const e=new w(.05,this.boneLength,.05),t=new a(e,this.defaultMaterial);t.translateY(.2),this.add(t);const n=new u(.05),s=new a(n,this.defaultMaterial);s.translateY(.4),this.add(s)}else if(this.name=="endEffector"){this.translateY(.4),this.rotateZ(45*Math.PI/180),this.rotateY(90*Math.PI/180);const e=this.boneLength/1.5,t=new w(.025,e,.025),n=new a(t,this.defaultMaterial);n.rotateZ(45*Math.PI/180),n.translateY(this.boneLength/4+.04),this.add(n);const s=new a(t,this.defaultMaterial);s.translateY(e/2),s.rotateZ(-75*Math.PI/180),s.translateY(e/2-.01225),n.add(s);const i=new a(t,this.defaultMaterial);i.rotateZ(-45*Math.PI/180),i.translateY(e/2+.04),this.add(i);const r=new a(t,this.defaultMaterial);r.translateY(e/2),r.rotateZ(75*Math.PI/180),r.translateY(e/2-.01225),i.add(r)}this.children.forEach(e=>{e instanceof h&&e.createMeshes()})}update(){if(this.boneId>=0){const e=this.chain.bones[this.boneId];this.lookAt(e.end.x,e.end.y,e.end.z),this.rotateX(Math.PI/2)}this.children.forEach(e=>{e instanceof h&&e.update()})}setRotation(e,t){this.name==e?this.setRotationFromEuler(t):this.children.forEach(n=>{n instanceof h&&n.setRotation(e,t)})}setDebugMode(e){this.defaultMaterial.wireframe=e,this.debugHelper.visible=e,this.children.forEach(t=>{t instanceof h&&t.setDebugMode(e)})}}class V extends R{constructor(){super(60,1920/1080,.1,10);o(this,"debugMode");o(this,"robotRoot");o(this,"robotChain");o(this,"ikSolver");o(this,"targetMesh");this.debugMode=!1,this.ikSolver=new d.Structure3D,this.robotChain=new d.Chain3D,this.robotRoot=new h("root",this.robotChain),this.targetMesh=new a}createScene(){this.camera.position.set(0,0,1.5),this.camera.lookAt(0,0,0),this.camera.up.set(0,1,0);const e=new C(this.camera,this.renderer.domElement);var t=new A("white",.3);this.scene.add(t);var n=new D("white",.6);n.position.set(0,2,1),this.scene.add(n);var s=new S,i=s.addFolder("Debugging");i.open();var r=i.add(this,"debugMode");r.name("Debug Mode"),r.onChange(p=>{this.toggleDebugMode(p)}),this.targetMesh.geometry=new u(.02),this.targetMesh.material=new f({color:"skyblue"}),this.targetMesh.position.set(.5,0,-.5),this.scene.add(this.targetMesh);const c=new k(this.camera,this.renderer.domElement);c.setSize(.5),c.attach(this.targetMesh),c.addEventListener("mouseDown",()=>{e.enabled=!1}),c.addEventListener("mouseUp",()=>{e.enabled=!0}),this.scene.add(c);const m=new z(10,10);this.scene.add(m),m.translateY(-.6),this.robotRoot.createSkeleton(),this.robotRoot.createMeshes(),this.ikSolver.add(this.robotChain,new d.V3(this.targetMesh.position.x,this.targetMesh.position.y,this.targetMesh.position.z)),this.robotRoot.translateY(-.6),this.scene.add(this.robotRoot)}update(e){this.ikSolver.targets[0].set(this.targetMesh.position.x,this.targetMesh.position.y,this.targetMesh.position.z),this.ikSolver.update(),this.robotRoot.update()}toggleDebugMode(e){this.robotRoot.setDebugMode(e)}}var G=new V;G.start();
